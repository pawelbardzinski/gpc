<div id="content" class="comments container">
<% topic = Topic.find(params[:topic_id]) %>
<div class="box white">
	<div class="top">
		<div class="top"><div class="top">&nbsp;</div></div>
	</div>
	<div class="middle">
		<div class="middle"><div class="middle">
			<div class="content">

				<div class="h1">Commenting on</div>

				<div class="header">
					<div class="vote">
						<span class="vote"><%= link_to "vote", {:action=>'upvote',:id=>topic.id}, :class=>"ajax_request" %></span>
						vote
					</div>

					<div class="topic">
						<span class="topic"><%= topic.subject %></span>
						<span class="points"><%= tp=topic.points %> <% if tp==1 %> point <% else %> points <% end %></span>
						<span class="date">
							<% 
								@blob = ((Time.now.to_i - topic.created_at.strftime("%s").to_i)/60) 
								@text = "minutes ago"
								if @blob > 120 then @blob = @blob/60; @text="hours ago"; end
								if @blob > 48 && @text=="hours ago" then @blob = @blob/24; @text="days ago"; end
								if @blob > 730 && @text=="days ago" then @blob = @blob/365; @text="years ago"; end 
							%>
							<%= @blob %> <%= @text %>
						</span>
						<span class="by">by <%= User.where(:id => topic.user_id).first.login %></span>
					</div>

					<div class="rightBox">
						<div class="in">
							<div class="in">
								
								<span class="go_back"><%= link_to "go back", {:controller=>'topics',:action=>'list'}, :class=>"ajax_request" %></span>
							</div>
						</div>
					</div>
				</div>
				
				<div class="comment">
					<div class="left">
					<% if topic.text != '' %>
						<div class="topic text"><%= word_wrap topic.text %></div>
					<% end %>
					<% if topic.url != '' %>
						<div class="topic url"><%= link_to(topic.subject,topic.url,:target=>'_blank') %></div>
					<% end %>
					</div>

					<div class="right">

						<div class="box green">
							<div class="h"><div><div> </div></div></div>

							<div class="content">
								<div class="g"> </div>

								<% if session[:user_id] %>

								<p>Your comment:</p>

								<%=form_for(:comment, :url=>{:action => 'create',:topic_id=>topic.id,:reply=>'false'}, :html => {:class=>"ajax_request"}) do |f| %>

								<%= f.text_area :comment %>

								<div class="submit">
									<%= submit_tag("add comment")%>
								</div>

								<% end %>

								<% else %>
									<div class="login">
										<p>Commenting disabled. You are not logged in.</p>
										<div class="actions">
											<%= link_to("logut", {:action=>'login'}, :class => "login") %> or <%= link_to("register", {:controller=>'topics',:action => 'create_account'}, :class => "register") %>
										</div>
									</div>
								<% end %>
							</div>
							<div class="f"><div><div> </div></div></div>
						</div>
					</div>
					<div class="clear"></div>
				</div>

				<div class="listing">
				<% @comments.each_with_index do |comment,iterator| %>

					<div class="comment">

						<div class="h"><div><div> </div></div></div>
						
						<div class="m"><div class="m"><div class="m">
							<div class="text"><%= simple_format(comment.comment) %></div>
						</div></div></div>

						<div class="f container"><div class="f"><div class="f">

						<% 
							@blob = ((Time.now.to_i - comment.created_at.strftime("%s").to_i)/60)
					 		@text = "minutes ago"
					 		if @blob > 120 then @blob = @blob/60; @text="hours ago"; end 
					 		if @blob > 48 && @text=="hours ago" then @blob = @blob/24; @text="days ago"; end 
					 		if @blob > 730 && @text=="days ago" then @blob = @blob/365; @text="years ago"; end
						%>
						<span class="date"><%= @blob %> <%= @text %></span>
						<span class="by">by <%= User.find(comment.user_id).login %></span>

						<span class="vote"><%= link_to "upvote", {:action=>'upvote', :id=>comment.id, :notice=>"Comment upvoted!"}, :class=>"ajax_request", :rel=>"content" %></span>
						<span class="points">
							<% cp=comment.points.to_i %>
							<% if cp!=1 %>
								<%= cp %> points
							<% else %> 
								<%= cp %> point 
							<% end %>
						</span>

						<div class="actions">
							<% if comment.user_id == session[:user_id] %>
								<%= link_to "edit", {:action => 'edit', :id => comment.id}, :class => "edit ajax_request" %>
								<%= link_to "delete", {:action => 'delete', :id=>comment.id, :topic_id=>params[:topic_id]}, :class=>"delete ajax_request"%>
							<% end %>
							<%= link_to "reply", {:action => "reply", :id => comment.id}, :class => "reply ajax_request" %>
						</div>
						
					</div></div></div>
					
					<div id="reply_<%= comment.id %>" class="reply" style="display: none;">
					</div>
					
				</div>
				<% end %>
				<div class="clear"></div>
			</div>
			<div class="clear"></div>

			</div>
		</div></div>
	</div>
<div class="bottom"><div class="bottom"><div class="bottom">&nbsp;</div></div></div>
</div>
</div>
